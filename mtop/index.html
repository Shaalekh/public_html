<!DOCTYPE html>
<html>
<head>
    <title>QR Code File Upload</title>
</head>
<body>
    <h2>Scan to Upload a File</h2>
    <div id="qr-code">
        <img id="qr" alt="QR Code" />
    </div>

    <h3>Uploaded Files:</h3>
    <ul id="file-list">
        <!-- List of uploaded files will appear here -->
    </ul>

    <script>
        // Generate a unique session ID
        const sessionId = Date.now() + Math.random().toString(36).substring(2);

        // Generate the upload URL with the session ID
        const uploadURL = `https://qrsr.co.in/mtop/upload_page.html?session=${sessionId}`;

        // Display the QR code for the session
        const qrImage = document.getElementById("qr");
        qrImage.src = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(uploadURL)}&size=200x200`;

        console.log("QR Code Generated for URL:", uploadURL);

        // Fetch files for the current session
        function fetchUploadedFiles() {
            fetch(`fetch_files.php?session=${sessionId}`)
                .then(response => response.json())
                .then(files => {
                    const fileList = document.getElementById("file-list");
                    fileList.innerHTML = ""; // Clear current list
                    files.forEach(file => {
                        fileList.innerHTML += `<li><a href="uploads/${sessionId}/${file}" target="_blank">${file}</a></li>`;
                    });
                })
                .catch(error => console.error('Error fetching files:', error));
        }

        // Fetch files every 5 seconds
        setInterval(fetchUploadedFiles, 5000);

        // Initial fetch
        fetchUploadedFiles();
    </script>
</body>
</html>
