<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File and Get QR Code</title>
    <style>
        .qr-container {
            margin-top: 20px;
            text-align: center;
        }

        img {
            border-radius: 15px; /* Rounded corners for QR Code */
        }

        /* Progress bar styling */
        #progressContainer {
            width: 100%;
            background-color: #f3f3f3;
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 20px;
            margin-top: 20px;
        }

        #progressBar {
            height: 100%;
            width: 0;
            background-color: green;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h2>Upload a File and Get QR Code</h2>

    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="fileToUpload" id="fileToUpload">
        <input type="submit" value="Upload File" name="submit">
    </form>

    <div id="result"></div>
    <div class="qr-container" id="qrContainer"></div>

    <!-- Progress bar container -->
    <div id="progressContainer" style="display: none;">
        <div id="progressBar"></div>
    </div>

    <script>
        // Handle form submission using AJAX
        document.getElementById("uploadForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent normal form submission

            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();

            // Reset the result and QR container
            document.getElementById("result").innerHTML = "";
            document.getElementById("qrContainer").innerHTML = "";
            document.getElementById("progressBar").style.width = "0%";

            // Show progress bar
            document.getElementById("progressContainer").style.display = "block";

            // Listen for the progress event
            xhr.upload.addEventListener("progress", function(e) {
                if (e.lengthComputable) {
                    var percentComplete = (e.loaded / e.total) * 100;
                    document.getElementById("progressBar").style.width = percentComplete + "%";
                }
            }, false);

            xhr.open("POST", "upload.php", true);

            xhr.onload = function() {
                if (xhr.status == 200) {
                    var response = JSON.parse(xhr.responseText);

                    if (response.error) {
                        document.getElementById("result").innerHTML = `<p style="color: red;">${response.error}</p>`;
                        document.getElementById("progressContainer").style.display = "none";
                    } else {
                        // Show the file download link
                        document.getElementById("result").innerHTML = `
                            <p>File uploaded successfully!<br>
                            Download link: <a href="${response.fileUrl}" target="_blank">${response.fileUrl}</a></p>
                            <p>Uploaded from: ${response.city}, ${response.region}, ${response.country}</p>
                        `;

                        // Show the QR code
                        var qrCodeUrl = response.qrCodeUrl;
                        document.getElementById("qrContainer").innerHTML = `
                            <h3>QR Code for Download Link:</h3>
                            <img src="${qrCodeUrl}" alt="QR Code">
                        `;
                    }

                    // Hide the progress bar once the upload is complete
                    document.getElementById("progressContainer").style.display = "none";
                } else {
                    document.getElementById("result").innerHTML = "<p style='color: red;'>Error uploading file.</p>";
                    document.getElementById("progressContainer").style.display = "none";
                }
            };

            xhr.send(formData); // Send the file data
        });
    </script>
</body>
</html>
